!function(){function e(e,t,r,l,a,o){function s(e,t,r,l,a){var o=Math.PI/180,s=e+r*Math.cos(-l*o),n=e+r*Math.cos(-a*o),i=e+r/2*Math.cos(-(l+(a-l)/2)*o),h=t+r*Math.sin(-l*o),c=t+r*Math.sin(-a*o),u=t+r/2*Math.sin(-(l+(a-l)/2)*o),f=["M",e,t,"L",s,h,"A",r,r,0,+(Math.abs(a-l)>180),1,n,c,"z"];return f.middle={x:i,y:u},f}o=o||{};var n=this,i=[],h=e.set(),c=e.set(),u=e.set(),f=a.length,d=0,v=0,m=0,p=o.maxSlices||100,g=parseFloat(o.minPercent)||1,b=Boolean(g);if(c.covers=h,1==f)u.push(e.circle(t,r,l).attr({fill:o.colors&&o.colors[0]||n.colors[0],stroke:o.stroke||"#fff","stroke-width":null==o.strokewidth?1:o.strokewidth})),h.push(e.circle(t,r,l).attr(n.shim)),v=a[0],a[0]={value:a[0],order:0,valueOf:function(){return this.value}},o.href&&o.href[0]&&h[0].attr({href:o.href[0]}),u[0].middle={x:t,y:r},u[0].mangle=180;else{for(var x=0;f>x;x++)v+=a[x],a[x]={value:a[x],order:x,valueOf:function(){return this.value}};for(a.sort(function(e,t){return t.value-e.value}),x=0;f>x;x++)b&&100*a[x]/v<g&&(p=x,b=!1),x>p&&(b=!1,a[p].value+=a[x],a[p].others=!0,m=a[p].value);for(f=Math.min(p+1,a.length),m&&a.splice(f)&&(a[p].others=!0),x=0;f>x;x++){var k=d-360*a[x]/v/2;if(x||(d=90-k,k=d-360*a[x]/v/2),o.init)var w=s(t,r,1,d,d-360*a[x]/v).join(",");var y=s(t,r,l,d,d-=360*a[x]/v),M=o.matchColors&&1==o.matchColors?a[x].order:x,B=e.path(o.init?w:y).attr({fill:o.colors&&o.colors[M]||n.colors[M]||"#666",stroke:o.stroke||"#fff","stroke-width":null==o.strokewidth?1:o.strokewidth,"stroke-linejoin":"round"});B.value=a[x],B.middle=y.middle,B.mangle=k,i.push(B),u.push(B),o.init&&B.animate({path:y.join(",")},+o.init-1||1e3,">")}for(x=0;f>x;x++)B=e.path(i[x].attr("path")).attr(n.shim),o.href&&o.href[x]&&B.attr({href:o.href[x]}),B.attr=function(){},h.push(B),u.push(B)}c.hover=function(e,o){o=o||function(){};for(var s=this,n=0;f>n;n++)!function(n,i,h){var c={sector:n,cover:i,cx:t,cy:r,mx:n.middle.x,my:n.middle.y,mangle:n.mangle,r:l,value:a[h],total:v,label:s.labels&&s.labels[h]};i.mouseover(function(){e.call(c)}).mouseout(function(){o.call(c)})}(u[n],h[n],n);return this},c.each=function(e){for(var o=this,s=0;f>s;s++)!function(s,n,i){var h={sector:s,cover:n,cx:t,cy:r,x:s.middle.x,y:s.middle.y,mangle:s.mangle,r:l,value:a[i],total:v,label:o.labels&&o.labels[i]};e.call(h)}(u[s],h[s],s);return this},c.click=function(e){for(var o=this,s=0;f>s;s++)!function(s,n,i){var h={sector:s,cover:n,cx:t,cy:r,mx:s.middle.x,my:s.middle.y,mangle:s.mangle,r:l,value:a[i],total:v,label:o.labels&&o.labels[i]};n.click(function(){e.call(h)})}(u[s],h[s],s);return this},c.inject=function(e){e.insertBefore(h[0])};var C=function(s,i,d,m){var p=t+l+l/5,g=r,b=g+10;s=s||[],m=m&&m.toLowerCase&&m.toLowerCase()||"east",d=e[d&&d.toLowerCase()]||"circle",c.labels=e.set();for(var x=0;f>x;x++){var k,w=u[x].attr("fill"),y=a[x].order;a[x].others&&(s[y]=i||"Others"),s[y]=n.labelise(s[y],a[x],v),c.labels.push(e.set()),c.labels[x].push(e[d](p+5,b,5).attr({fill:w,stroke:"none"})),c.labels[x].push(k=e.text(p+20,b,s[y]||a[y]).attr(n.txtattr).attr({fill:o.legendcolor||"#000","text-anchor":"start"})),h[x].label=c.labels[x],b+=1.2*k.getBBox().height}var M=c.labels.getBBox(),B={east:[0,-M.height/2],west:[-M.width-2*l-20,-M.height/2],north:[-l-M.width/2,-l-M.height-10],south:[-l-M.width/2,l+10]}[m];c.labels.translate.apply(c.labels,B),c.push(c.labels)};return o.legend&&C(o.legend,o.legendothers,o.legendmark,o.legendpos),c.push(u,h),c.series=u,c.covers=h,c}var t=function(){};t.prototype=Raphael.g,e.prototype=new t,Raphael.fn.piechart=function(t,r,l,a,o){return new e(this,t,r,l,a,o)}}();