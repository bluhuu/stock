<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="app.css">
	<link rel="stylesheet" href="jquery-ui.css">
</head>
<body>
	<div id="setting">
			<div class="title">选择浏览器显示图标</div>
			<div class="iconlist"></div>
			<span class="close">X</span>
			<a href="#" class="default">使用默认图标</a>
	</div>
	<ul class="nav-tabs">
		<li class="tab on" data-type="default"><a href="#">我的自选</a></li>
		<li class="tab"><a href="http://lhb.stock360.cn" target="_blank">龙虎榜</a></li>
		<li class="tab"><a href="http://lhb.stock360.cn/dz" target="_blank">破定增价股</a></li>
		<!-- <li class="tab"><a href="#" class="setting">个人设置</a></li> -->
	</ul>
	<div class="tab-content">
		<div class="tab-pane on">
			<form id="search" action="http://www.so.com/s" method="get" target="_self">
				<div class="search">
					<div class="search-input">
						<input type="text" id="input" name="q" placeholder="代码/名称/拼音">
					</div>
					<div class="search-button">
						<input type="submit" value="搜索">
					</div>
				</div>
			</form>
			<div id="zxg">
				<div class="loading"><img src="images/loading.gif" alt=""></div>
				<div class="zxg-stock">
					<div class="zxg-hd gclearfix">
						<span class="top">置顶</span>
						<span class="name">名称(代码)</span>
						<span class="price">最新价</span>
						<span class="grow">涨跌幅</span>
						<span class="hands">换手率</span>
						<span class="Pricetobookratio">市净率</span>
						<span class="pe_ttm">市盈率-静</span>
						<span class="pe_lyr">市盈率-动</span>
						<span class="remark">备注</span>
						<span class="delete">删除</span>
					</div>
					<div class="zxg-bd">
						<ul class="zxg-list">
						</ul>
					</div>
					<div class="tipStock"><span class="ok"></span>列表保存已成功</div>
				</div>
			</div>
		</div>
		<div class="tab-pane">
			<ul class="stockList">
				<li class="item head">
					<span class="title">股票名称(代码)</span>
					<span class="rating">推荐星级</span>
					<span class="type">类型</span>
					<span class="topic">概念</span>
				</li>
			</ul>
		</div>
		<div class="tab-pane">
			<ul class="weixin" id="weixin">

			</ul>
		</div>
	</div>

	<div class="remark-form">
		<div class="remark-hd">
			<span class="name"></span>(<span class="code"></span>) 当前股价:<span class="price"></span>
			<span class="close">X</span>
		</div>
		<div class="remark-bd">
			<textarea id="remark" placeholder="请输入您的购入理由和目标价位..."></textarea>
			<input type="hidden" id="remark-key" value="">
			<input type="button" class="btn" value="提交">
		</div>
	</div>
	<div class="mask"></div>
	<div id="warning" ></div>
	<div id="extra1" class="canvasDiv" role="echart" style="width:500px;height:400px;"></div>
	<div id="extra2" class="canvasDiv" role="echart" style="width:500px;height:400px;"></div>
	<div id="extra3" class="canvasDiv" role="echart" style="width:500px;height:400px;"></div>
	<div id="extra4" class="canvasDiv" role="echart" style="width:500px;height:400px;"></div>
</body>
	<script src ="jquery_1102.js"></script>
	<script src ="jquery-ui.js"></script>
	<script src ="libs\jquery.zclip.js"></script>
	<script src ="util.js"></script>
	<script src ="suggest.js"></script>
	<script src ="stock.js"></script>
	<script src ="app.js"></script>
	<script src ="asset/lib/echarts.js"></script>
	<script src ="asset/lib/moment.js"></script>

	<script type ="text/javascript">
		function unique(arr) {
			var result=[];
			for(var i=0; i<arr.length; i++){
				if(result.indexOf(arr[i])==-1){
					result.push(arr[i])
				}
			}
			return result;
		}
		function chart(div,chartdata,item){
			var worldMapContainer = document.getElementById(div);
			var myChart = echarts.init(worldMapContainer);
			option = {
				title:{
					text:item,
					left: 'center'
				},
				tooltip : {
					trigger: 'axis',
					axisPointer : {            // 坐标轴指示器，坐标轴触发有效
						type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
					}
				},
				legend: {
					show:false,
					data:chartdata.seriesname
				},
				grid: {
					left: '3%',
					right: '4%',
					bottom: '3%',
					containLabel: true
				},
				xAxis : [
					{
						type : 'category',
						data : chartdata.xAxisdata
					}
				],
				yAxis : [
					{
						type : 'value'
					}
				],
				series : [
					{
						name:chartdata.seriesname[0],
						type:'bar',
						data:chartdata.seriesdatalist[0].map(function(value){return value[item]}),
						markLine : {
							lineStyle: {
								normal: {
									type: 'dashed'
								}
							},
							data : [
								[{type : 'min'}, {type : 'max'}]
							]
						}
					},
					{
						name:chartdata.seriesname[1],
						type:'bar',
						data:chartdata.seriesdatalist[1].map(function(value){return value[item]})
					},
					{
						name:chartdata.seriesname[2],
						type:'bar',
						data:chartdata.seriesdatalist[2].map(function(value){return value[item]})
					},
					{
						name:chartdata.seriesname[3],
						type:'bar',
						data:chartdata.seriesdatalist[3].map(function(value){return value[item]})
					}
					]
				};
				myChart.setOption(option);
			}
		function fetchData(url,symbol,size,callback){
			$.ajax({
					url: url,
					dataType: "jsonp",
					data: {
						symbol:symbol,
						size:size,
						page:1,
						_:new Date()
					},
					success: function(json, textStatus){
						if(textStatus == "success"){
							callback(json);
						}
					},
					error: function(XMLHttpRequest, textStatus, errorThrown) {
						console.log("查询失败: ",XMLHttpRequest);
					}
				});
		}
		function extrData(json){
			var reportdatelist = json.list.map(function(value,index,arr){
				return {
					xAxisdata:moment(value.reportdate,"YYYYMMDD").format("YYYY"),
					seriesname:moment(value.reportdate,"YYYYMMDD").format("MM")
				};
			});
			var xAxisdata = unique(reportdatelist.map(function(value){return value.xAxisdata}))
										.sort(function(a,b){return b-a;});
			var seriesname = unique(reportdatelist.map(function(value){return value.seriesname}))
										.sort(function(a,b){return b-a;});
			var seriesdatalist=[];
			for(var i=0;i<seriesname.length;i++){
				var flag = json.list.filter(function(element){
					if(moment(element.reportdate,"YYYYMMDD").format("MM") ==seriesname[i]){
						return true;
					}
				});
				if(moment(flag[0].reportdate,"YYYYMMDD").format("YYYY") != xAxisdata[0]){
					flag = [{}].concat(flag);
				}
				if(moment(flag[flag.length-1].reportdate,"YYYYMMDD").format("YYYY") != xAxisdata[xAxisdata.length-1]){
					flag = flag.concat([{}]);
				}
				seriesdatalist.push(flag);
			}
			var chartdata = {
				xAxisdata:xAxisdata,
				seriesname:seriesname.map(function(value){return value+"月"}),
				seriesdatalist:seriesdatalist
			};
			return chartdata;
		}
		function finmainindex(json){
			var chartdata = extrData(json);
			chart('extra1',chartdata,"totalliab");
		}
		function incstatement(json){
			var chartdata = extrData(json);
			chart('extra2',chartdata,"biztotcost");
		}
		// fetchData("https://xueqiu.com/stock/f10/finmainindex.json","SH600366",30,finmainindex);
		fetchData("https://xueqiu.com/stock/f10/incstatement.json","SH600366",30,incstatement);
	</script>
</html>
